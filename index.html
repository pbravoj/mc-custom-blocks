function update() {
    var pos = document.getElementById('p').value;
    var lay = document.getElementById('l').value;

    var logic = `%%[ 
        SET @ItemIndex = ${pos}
        SET @LayoutName = "${lay}"
        SET @CampID = AttributeValue("Campaign_ID")
        IF Empty(@CampID) THEN SET @CampID = "SKU_PARAMETRICO" ENDIF
        
        SET @ColumnaSKU = Concat("SKU_", @ItemIndex)
        SET @SKU = Lookup("Campanas_Config_DE", @ColumnaSKU, "Campaign_ID", @CampID)

        IF NOT Empty(@SKU) THEN
            SET @Filas = LookupRows("Master_Products_DE", "SKU", @SKU)
            IF RowCount(@Filas) > 0 THEN
                SET @Fila = Row(@Filas, 1)
                SET @Nombre = Field(@Fila, "NOMBRE")
                SET @Precio = Field(@Fila, "PRECIO_MESON")
                
                /* NUEVO: Mapeo de la Marca para la URL din√°mica */
                SET @Marca = Field(@Fila, "MARCA")
                SET @UrlMarca = Concat("https://omni.implementos.cl/assets/images/marca_producto/", @Marca, ".png")
                
                SET @Descripcion = Concat(Field(@Fila, "DESCRIP_L1"), " ", Field(@Fila, "DESCRIP_L2"))
                SET @PrecioFinal = FormatCurrency(@Precio, "es-CL")
                SET @Imagen = Concat("https://images.implementos.cl/img/1000/", @SKU, "-1.jpg")
            ENDIF
        ENDIF
    ]%%`;

    var render = `%%[ IF NOT Empty(@SKU) THEN OUTPUT(ContentBlockByName(Concat("Content Builder\\BPP\\", @LayoutName))) ENDIF ]%%`;

    sdk.setContent(logic + render);
    
    sdk.setAsset({
        "name": "BPP_Selector_V2",
        "metaData": {
            "thumbnail": { "url": "https://image.cl-implementos.cl/lib/fe2b11737164057a7d1676/m/1/a72fde74-d3e3-4dac-b9c2-72e747947e81.jpg" }
        }
    });
}
