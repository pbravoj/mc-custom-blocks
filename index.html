<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
  
  .bpp-frame {
    width: 340px; padding: 50px 10px 5px 10px; background-color: #F4F6F9; 
    display: inline-block; text-align: center; overflow: visible !important;
  }

  .bpp-tarjeta { 
    width: 320px; font-family: 'Inter', Arial, sans-serif; border-radius: 30px; 
    background-color: #8EA3B4; 
    background-image: radial-gradient(circle at 50% 30%, rgba(255,255,255,0.7) 0%, rgba(255,255,255,0) 60%);
    text-align: left; position: relative; z-index: 1; 
    box-shadow: 0 10px 30px rgba(0,0,0,0.1); display: block; margin: 0 auto;
    overflow: visible;
  }
  
  .bpp-img-container { position: relative; width: 100%; height: 160px; z-index: 5; }
  
  .bpp-prod-img { 
    width: 260px; height: auto; max-height: 200px; object-fit: contain; 
    display: block; margin: 0 auto; position: absolute; top: -50px; left: 30px;
    z-index: 10; filter: drop-shadow(0 15px 20px rgba(0,0,0,0.25)); 
  }
  
  .bpp-brand-logo { position: absolute; bottom: 0px; right: 25px; width: 75px; z-index: 15; }
  
  .bpp-info { padding: 10px 25px 5px 25px; color: #ffffff; position: relative; z-index: 20; background: transparent; }
  .bpp-sku { font-size: 11px; font-weight: 700; color: #f3f4f6; margin-bottom: 3px; }
  .bpp-name { font-size: 14px; font-weight: 700; line-height: 1.2; margin: 0 0 20px 0; height: 34px; overflow: hidden; }

  /* CONTENEDOR DE PRECIO */
  .bpp-price-container { position: relative; width: 100%; margin-bottom: 5px; background: transparent; }

  .bpp-escala-top { 
    position: absolute; top: -18px; left: 5px; width: 100%;
    font-size: 13px; font-weight: 700; color: #ffffff; z-index: 30;
  }

  .bpp-price-row { 
    background-color: #0055aa; color: #ffffff; padding: 0 15px; border-radius: 15px;
    display: flex; align-items: center; justify-content: space-between;
    height: 50px; position: relative; z-index: 25;
  }

  .bpp-price-main { display: flex; align-items: baseline; }
  .bpp-currency { font-size: 22px; font-weight: 700; margin-right: 2px; }
  .bpp-price { font-size: 42px; font-weight: 700; letter-spacing: -1px; line-height: 1; }

  .bpp-escala-bottom { 
    position: absolute; bottom: -18px; left: 5px; width: 100%;
    font-size: 12px; font-weight: 400; font-style: italic; color: #ffffff; z-index: 30;
  }

  .bpp-price-side { display: flex; align-items: center; gap: 5px; }
  .bpp-iva { font-size: 13px; font-weight: 400; line-height: 1; }
  .bpp-img-escala { width: 42px; height: 42px; object-fit: contain; }

  /* BOTÃ“N: Distancia reducida a 5px */
  .bpp-btn { 
    display: block; float: right; 
    margin-top: 5px; 
    background-color: #e11d48; color: #ffffff !important; 
    text-decoration: none; padding: 10px 22px; border-radius: 10px; 
    font-size: 16px; font-weight: 900; text-transform: uppercase;
    position: relative; z-index: 40;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }

  .bpp-v { font-size: 7px; color: rgba(255,255,255,0.3); clear: both; padding-top: 8px; text-align: right; }
</style>

%%[
  SET @CON_ESCALA = Field(@Fila, "CON_PRECIO_ESCALA")
  SET @ESCALA_PRECIO_1 = Field(@Fila, "ESCALA_PRECIO_1")
  SET @DESDE_ESCALA1 = Field(@Fila, "ESCALA_DESDE_1")
  SET @HASTA_ESCALA1 = Field(@Fila, "ESCALA_HASTA_1")

  IF @CON_ESCALA == "true" OR @CON_ESCALA == 1 THEN
      SET @PrecioFinalVar = FormatCurrency(@ESCALA_PRECIO_1, "es-CL")
  ELSE
      SET @PrecioFinalVar = FormatCurrency(@Precio, "es-CL")
  ENDIF

  SET @PrecioLimpio = Replace(@PrecioFinalVar, "$", "")
  SET @PrecioMesonFormateado = FormatCurrency(@Precio, "es-CL")
  SET @UrlMarcaFinal = Concat("https://images.implementos.cl/marcas/h/logo_", @Marca, "-1_C.png")
]%%

<div class="bpp-frame">
  <div class="bpp-tarjeta">
    <div class="bpp-img-container">
      <a href="https://www.implementos.cl/producto/%%=v(@SKU)=%%" target="_blank">
        <img src="%%=v(@Imagen)=%%" class="bpp-prod-img" alt="Producto">
      </a>
      <img src="%%=v(@UrlMarcaFinal)=%%" class="bpp-brand-logo" alt="Marca">
    </div>

    <div class="bpp-info">
      <div class="bpp-sku">SKU: %%=v(@SKU)=%%</div>
      <h3 class="bpp-name">%%=v(@Nombre)=%%</h3>

      <div class="bpp-price-container">
        %%[ IF @CON_ESCALA == "true" OR @CON_ESCALA == 1 THEN ]%%
          <div class="bpp-escala-top">Desde %%=v(@DESDE_ESCALA1)=%% %%[ IF @HASTA_ESCALA1 != 9999 THEN ]%% a %%=v(@HASTA_ESCALA1)=%% %%[ ENDIF ]%% Unid.</div>
        %%[ ENDIF ]%%

        <div class="bpp-price-row">
          <div class="bpp-price-main">
            <span class="bpp-currency">$</span>
            <span class="bpp-price">%%=v(@PrecioLimpio)=%%</span>
          </div>
          <div class="bpp-price-side">
            <div class="bpp-iva">IVA<br>INC</div>
            %%[ IF @CON_ESCALA == "true" OR @CON_ESCALA == 1 THEN ]%%
              <img src="https://www.implementos.cl/assets/images/llevaMasPagaMenos/50x50_cuadrado.webp" class="bpp-img-escala">
            %%[ ENDIF ]%%
          </div>
        </div>

        %%[ IF @CON_ESCALA == "true" OR @CON_ESCALA == 1 THEN ]%%
          <div class="bpp-escala-bottom">Unid. %%=v(@PrecioMesonFormateado)=%%</div>
        %%[ ENDIF ]%%
      </div>

      <a href="https://www.implementos.cl/producto/%%=v(@SKU)=%%" class="bpp-btn">COMPRAR</a>
      
      <div class="bpp-v">L: v3.0.8 | M: %%=v(@VersionMotor)=%%</div>
    </div>
  </div>
</div>
